<!-- announcements.html -->
<head>
  <title>Announcements</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
  <div class="container">
	
    <header>
    <img src="hardingBanner.jpg" width="100%"/>
      
      
      
    </header>
    <div class="settings-button">
    <h1>Announcements</h1>
    {{> loginButtons}}
    <p></p>
    {{#if currentUser}} 
        <button class="manage-subscriptions">
        {{#if showManageSubscriptions}}
          Show Announcements
        {{else}}
          Manage Subscriptions
        {{/if}}
        </button>
        <br>
        {{#if showManageSubscriptions}}
          {{#if isAdmin}}
            <form class="new-group">
              <input type="text" name="text" placeholder="Type to add a new group" />
            </form>
          <p></p>
          {{/if}}
          <br>
          <ul>
            {{#each groups}}
              {{> group}}
            {{/each}}
          </ul>
          {{/if}}
        {{/if}}
    </div>

    {{#if showAnnouncements}}
      {{#if currentUser}}
        <div class="announcements">
        
        <div class="group-buttons">
            <button class="live-feed">Live Feed</button>
        </div>

        {{#each groups}}
          {{#if subscribed}}
          <div class="group-buttons">
            <button class="group-select">{{group}}</button>
          </div>
          {{/if}}
        {{/each}}
        
        {{#if liveFeed}}
          {{> feed}}
        {{/if}}

        {{#each groups}}
          {{#if subscribed}}
            {{#if groupSelect}}
              <div id="{{group}}-heading">
                <br>
                <h2><strong>{{group}} Announcements</strong></h2>
                  {{#if isMember}}
                  <ul>
                  <form class="new-announcement" name="{{group}}">
                    
                    <input class= "new-announcement-text" type="text" name="text" placeholder="Type to add a new announcement" />

                    Public Announcement    <input type="checkbox" name="public" id="publicCheckbox">
                    <button class="new-announcement-button"> Submit new announcement </button>
                    <br><br>
                    <!-- <input type="checkbox" name="public-announcement" value="public"> -->
                  </form>
                  </ul>
                  <hr>
                  
                  
                  {{/if}}
                  <ul>
                  {{#each announcementsByGroup}}
                    {{#if privateAnnouncement}}
                      {{#if isMember}}
                        {{> announcement}}
                      {{/if}}
                    {{/if}}
                    
                    {{#if publicAnnouncement}}
                      {{> announcement}}
                    {{/if}}
                  {{/each}}
                  </ul>
              </div>
            {{/if}}
          {{/if}}
        {{/each}}
        </div>
      {{/if}}
    {{/if}}
  </div>
</body>

<template name="announcement">
  <div id="{{group}}-announcement"> 
    <li>
      {{#if hasRights}}
        <button class="delete">&times;</button>
      {{/if}}
      <span class="text"><strong>{{text}} - {{username}} - {{createdAt}}</strong></span>
        {{#each comments}}
          {{> comment}}
        {{/each}}
        {{#if isMember}}
          <form class="new-comment" name="{{announcement}}">
            <input type="text" name="text" placeholder="Type to add a new comment" />
          </form>
        {{/if}}
    </li>
  </div>
</template>

<template name="group">
  <li>
    <li>
     <h2>{{group}}</h2>{{#if isGroupAdmin}}-Admin{{/if}}

    </li>
  	{{#if hasRights}}
      <button class="delete-group">Delete Group</button>
    {{/if}}
      <button class="toggle-subscribe">
        {{#if subscribed}}
          <br>Unsubscribe
        {{else}}
          <br>Subscribe
        {{/if}}
      </button>
       <button class="request-membership">
        {{#if isMember}}
          Member<br>Click to delete
        {{else}}
          Request<br>Membership
        {{/if}}
      </button>
      {{#if isAdmin}}
       <button class="manage-users">
        <br>Manage Users
      </button>
      {{/if}}
     
  </li>
  {{# if isAdmin}}
  {{# if manageGroupUsers}}
    {{ > showUserList}}
  {{/if}}
  {{/if}}

</template>



<template name="comment">
  <div id="{{announcement}}-comment"> 
    <li>
      {{#if hasRights}}
        <button class="delete-comment">&times;</button>
      {{/if}}
      <span class="text">{{text}} - {{username}}</span>
    </li>
  </div>
</template>

<template name="feed">
  <div id="{{group}}-heading">
  <br>
    <h2><strong>Live Feed</strong></h2>
      <ul>
        {{#each announcementsAll}}
          {{#if subscribed}}

            {{#if privateAnnouncement}}
              {{#if isMember}}
                <h4><strong>{{group}}</strong>{{#if isMember}} - Member {{/if}}</h4>{{> announcement}}
              {{/if}}
                    
            {{/if}}
                    
            {{#if publicAnnouncement}}
              <h4><strong>{{group}}</strong>{{#if isMember}} - Member {{/if}}</h4>{{> announcement}}
            {{/if}}


          
          {{/if}}
        {{/each}}
      </ul>
  </div>
</template>

<template name="showUserList">
  <li>
      {{#each userData}}
          {{#if membershipRequested}}
          <li class="membership-requested">
            <strong>{{username}}</strong> - 
              Membership Requested 


              {{#if manageUserMembership}} <button class="membership"> Delete Membership</button>
              {{else}}
                <button class="membership"> Add Membership </button>
              {{/if}}
          </li>
          {{else}}

            {{#if manageUserSubscribed}}
            <li>
              <strong>{{username}}</strong> - 
                {{#if manageUserMembership}} Member 
                {{/if}}

                {{#if manageUserMembership}} <button class="membership"> Delete Membership</button>
                {{else}}
                  <button class="membership"> Add Membership </button>
                {{/if}}
            </li>
            {{/if}}
          {{/if}}
      {{/each}}
    </li>
</template>
